# 2-1: 絶対圧センサーのデータを Azure IoT Central で可視化

絶対圧センサーのデータを Azure IoT Central (以下、IoTC) で可視化してみましょう

### <a name="2-1-1">2-1-1 IoTC :  アプリケーションを作成</a>


<br/>

Webブラウザで`https://apps.azureiotcentral.com`を開いてください。URLを開く際に、Microsoftアカウントでのサインイン認証が求められます。保有しているMicrosoftアカウントを使って、サインインしてください。  
開くと、Azure IoT Centralのアプリケーションが一覧表示されます。  
左上にある、①`新しいアプリケーション`をクリックして、アプリケーションを作成してください。

![1](img/1.png)

<br/>

次に、アプリケーションの作成に必要な情報を設定します。  
下表のとおり設定して、最後に⑧`作成`をクリックしてください。

|項目名|値|備考|
|:--|:--|:--|
|①支払いプラン|従量課金制|評価版を選択すると後の手順で作業が進められません(※)|
|②アプリケーションテンプレート|カスタムアプリケーション||
|③アプリケーション名|==任意==|SORACOM IoTC handson|
|④URL|==ユニークURL==|同じURLが既に存在するとエラーになります|
|⑤ディレクトリ|==任意==||
|⑥Azureサブスクリプション|==任意==||
|⑦リージョン|West US||

※）支払いプランで従量課金制を選択してもこのコンテンツの実施による課金は発生しません。

![2](img/2.png)  
![3](img/3.png)

<br/>

しばらくすると、アプリケーションが作成されて、ダッシュボードが表示されます。  
黄色いポップアップが表示されている場合は、①`了解しました`をクリックして、表示を消してください。

![4](img/4.png)

<br/>

次の画像のとおり表示されていることを確認してください。

![5](img/5.png)

---

### <a name="2-1-2">2-1-2 IoTC : デバイステンプレートを作成</a>

左の①`デバイステンプレート`をクリックしてください。デバイステンプレートの一覧が表示されます。  
ここで、右上の②[`+`]マークをクリックして、デバイステンプレートを作成してください。  
この時、「アプリケーションはまだプロビジョニング中」という表示が出た場合には少し待ってから再度試してみてください。

![6](img/6.png)

<br/>

デバイステンプレートの種類は①`カスタム`を選択してください。

![7](img/7.png)

<br/>

デバイステンプレートの名前に①`Barometer`と入力して、②`作成`をクリックしてください。

![8](img/8.png)

<br/>

左の①`デバイス`をクリックしてください。  
②`Barometer (1.0.0)`という名前のデバイステンプレートが表示されて、`Barometer(シミュレート済み)`という名前のデバイスが1つ含まれていることを確認してください。

![10](img/10.png)

---

### <a name="2-1-3">2-1-3 IoTC : 測定に気圧・温度テレメトリを追加</a>

①`デバイステンプレート`をクリックして、②`Barometer`デバイステンプレートをクリックしてください。

![11](img/11.png)

<br/>

デバイステンプレートの①`測定`タブ画面が表示されます。  
②`新規` > `テレメトリ`をクリックしてください。測定の追加画面が表示されます。

![12](img/12.png)

<br/>

測定の種類が3つ表示されているので、その中から①`テレメトリ`をクリックしてください。

![13](img/13.png)

<br/>

次に、測定の追加に必要な情報を設定します。  
下表のとおり設定して、最後に④`保存`をクリックしてください。

|項目名|値|備考|
|:--|:--|:--|
|①表示名|気圧||
|②フィールド名|pres|**必ず、この値にしてください**|
|③単位|Pa||

同様に温度のテレメトリも追加します。

|項目名|値|備考|
|:--|:--|:--|
|①表示名|温度||
|②フィールド名|temp|**必ず、この値にしてください**|
|③単位|℃||

![14](img/14.png)

<br/>

次の画像のとおり、テレメトリに**表示名**の測定項目が追加されていることを確認してください。

![15](img/15.png)

---

### <a name="2-1-4">2-1-4 IoTC : デバイスを追加</a>

<br/>

左の①`デバイス`をクリックしてください。②`Barometer (1.0.0)`デバイステンプレートに含まれているデバイスが一覧表示されます。  
ここで、上にある③[`+`]マークをクリックして、④`実際`を選択してください。

![16](img/16.png)

<br/>

①`デバイス名`に**必ず** `wiolte` と入力して、②`作成`をクリックしてください。

![17](img/17.png)

<br/>

すると、作成した Wio LTE デバイスが表示されます。  
右上の①`接続`をクリックして、このデバイスの接続情報を表示してください。

![18](img/18.png)

<br/>

この内容は次の手順で使いますので**メモ帳などにコピー**しておいてください。

![19](img/19.png)

### <a name="2-1-5">2-1-5 SORACOM Beam 用の接続情報を作成</a>

1. [Azure CLI](https://shell.azure.com) または bash が利用できるターミナルを開きます。
2. 以下の コマンドでスクリプトをダウンロードします。  
`wget https://gist.githubusercontent.com/j3tm0t0/b5bd4cf95aee4abca9f73b43d3935a3f/raw/7ae5b041e6d1a233445c84a28c5b634c85a641a2/register.sh`
3. 以下のコマンドで SORACOM Beam 用の接続情報を作成します。
`bash ./register.sh [スコープID] [デバイスID] [主キー]`
4. 以下の例ように出力される内容は次の手順で使いますので**メモ帳などにコピー**しておいてください。

```
SORACOM Beam Setting
- MQTT entry point
  Type: Azure IoT Hub
  Protocol: MQTTS
  Host name: iotc-003580fa-90ef-4204-85bf-xxxxxxxxxxxx.azure-devices.net
  Port number: 8883
- Credentials
  Credentials set ID: 0ne00xxxxxx-wiolte
  Description: Device wiolte in Scope 0ne000828AD
  Type: Azure IoT credentials
  Access Policy name: (blank)
  Shared access key: Au1Aqjr+zElOc8f8kqave5W+Pd9IozPxxxxxxxxxxxx=
```

### <a name="2-1-6">2-1-6 SORACOM Beam を設定</a>
TBD

### <a name="2-1-7">2-1-7 Wio LTE にスケッチを設定</a>
TBD

### <a name="2-1-8">2-1-8 データの転送</a>
TBD

### <a name="2-1-9">2-1-9 データの確認</a>
TBD
